/* membranejs 0.0.1 2014-11-20 */

define("MJS/membrane",["exports"],function(a){"use strict";function b(a){for(var b,c,d=a.length;d;b=Math.floor(Math.random()*d),c=a[--d],a[d]=a[b],a[b]=c);return a}function c(a){var b=["["];return _.forEach(a,function(a,c){_.times(a,function(){b.push(c)})}),b.push("]"),b.join(" ")}var d={},e=function(a){console&&console.log(a),"undefined"!=typeof $&&$(".log").prepend(a+"<br>")},f=function(a){_.assign(this,{membrane:null,world:{}},a)};f.prototype.simulate=function(a){var b=!0;a=a||100,d.log("simulating");for(var c=0;a>c&&b;++c){if(d.log("- step: "+(c+1)),d.log("system world before: "+this.toString()),b=this.membrane.step(this.world),b.dissolved)throw"Error: Outermost membrane dissolved";d.log("system world after: "+this.toString())}d.log("finished")},f.prototype.toString=function(){return this.worldToString()+" "+this.membrane.toString()},f.prototype.worldToString=function(){return c(this.world)};var g=function(a){_.assign(this,{type:g.Type.EVOLVE,reactants:{},products:{},charge:null,label:null},a)},h=0,i=function(a){_.assign(this,{rules:[],world:{},membranes:[],label:null,charge:null},a),this.id=++h};i.prototype.step=function(a){for(var c=this,e=!1,f=!1,h=0;h<this.membranes.length;++h){var i=this.membranes[h],j=i.step(c.world);j.dissolved&&(d.log("dissolving "+i.id),this.membranes.splice(h--,1)),j&&(e=!0)}var k=[];_.forEach(this.rules,function(a){_.times(a.numberApplications(c.world),function(){k.push(a)})}),d.log("membrane before: "+this.toString()),b(k);var l=_.cloneDeep(this.world);return _.forEach(k,function(b){var d=b.applyRule(l,c.world);return _.isObject(d)&&_.forEach(d,function(b,c){"undefined"==typeof a[c]&&(a[c]=0),a[c]+=b}),d&&(e=!0,b.type===g.Type.DISSOLVE)?(f=!0,!1):void 0}),d.log("membrane after: "+this.toString()),f?{dissolved:!0}:e},i.prototype.toString=function(){var a=this.worldToString(),b="";return _.forEach(this.membranes,function(a){b+=a.toString()}),"("+this.id+")["+a.slice(1,a.length-1)+b+"]"},i.prototype.worldToString=function(){return c(this.world)};var g=function(a){_.assign(this,{type:g.Type.EVOLVE,reactants:{},products:{},charge:null,label:null},a)};g.prototype.numberApplications=function(a){var b,c=0,d=_.cloneDeep(a);do b=this.applyRule(d),b&&(c+=1);while(b);return c},g.prototype.applyRule=function(a,b){var c=this,e=!0,f={};return _.forEach(c.reactants,function(b,c){return"undefined"==typeof a[c]||a[c]<b?(e=!1,!1):void 0}),e&&(_.forEach(c.reactants,function(c,d){a[d]-=c,b&&(b[d]-=c)}),b&&d.log("apply rule: "+this.toString()),_.forEach(c.products,function(a,d){var e=b;(c.type===g.Type.SEND_OUT||c.type===g.Type.DISSOLVE)&&(e=f),e&&"undefined"==typeof e[d]&&(e[d]=0),e&&(e[d]+=a)})),_.keys(f).length?f:e},g.prototype.toString=function(){return"Rule("+this.type+") react"+c(this.reactants)+" prod"+c(this.products)},g.Type={EVOLVE:"evolve",SEND_OUT:"sendOut",DISSOLVE:"dissolve"},d.log=e,d.MSystem=f,d.Membrane=i,d.Rule=g,a["default"]=d});
//# sourceMappingURL=membrane.min.js.map