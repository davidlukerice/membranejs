/* membranejs 0.0.3 2014-12-05 */

define("MJS/mSystem",["MJS/mjs","exports"],function(a,b){"use strict";var c=a["default"],d=function(a){_.assign(this,{membrane:null,world:{}},a)};d.prototype.clone=function(){return new d({membrane:this.membrane.clone(),world:_.cloneDeep(this.world)})},d.prototype.simulate=function(a){var b=!0;a=a||100,c.log("simulating");for(var d=0;a>d&&b;++d){if(c.log("- step: "+(d+1)),c.log("system world before: "+this.toString()),b=this.membrane.step(this.world),b.dissolved)throw"Error: Outermost membrane dissolved";c.log("system world after: "+this.toString())}d===a&&c.log("step limit("+a+") reached"),c.log("finished")},d.prototype.toString=function(){return this.worldToString()+" "+this.membrane.toString()},d.prototype.worldToString=function(){return c.setToString(this.world)},c.MSystem=d,b["default"]=d}),define("MJS/membrane",["MJS/mjs","MJS/rule","exports"],function(a,b,c){"use strict";function d(a){for(var b,c,d=a.length;d;b=Math.floor(Math.random()*d),c=a[--d],a[d]=a[b],a[b]=c);return a}var e=a["default"],f=b["default"],g=0,h=function(a){_.assign(this,{rules:[],world:{},membranes:[],label:null,charge:null},a),"undefined"==typeof this.id&&(this.id=++g)};h.prototype.clone=function(){var a=_.map(this.rules,function(a){return a.clone}),b=_.map(this.membranes,function(a){return a.clone()});return new h({id:this.id,rules:a,world:_.cloneDeep(this.world),membranes:b,label:this.label,charge:this.charge})},h.prototype.step=function(a){for(var b=this,c=!1,g=!1,h=0;h<this.membranes.length;++h){var i=this.membranes[h],j=i.step(b.world);j.dissolved&&(e.log("dissolving "+i.id),this.membranes.splice(h--,1)),j&&(c=!0)}var k=[];_.forEach(this.rules,function(a){_.times(a.numberApplications(b.world,b.membranes),function(){k.push(a)})}),e.log("membrane before: "+this.toString()),d(k);var l=_.cloneDeep(this.world);return _.forEach(k,function(d){var e=d.applyRule(l,b.world,b.membranes);return _.isObject(e)&&_.forEach(e,function(b,c){"undefined"==typeof a[c]&&(a[c]=0),a[c]+=b}),e&&(c=!0,d.type===f.Type.DISSOLVE)?(g=!0,!1):void 0}),e.log("membrane after: "+this.toString()),g?{dissolved:!0}:c},h.prototype.toString=function(){var a=this.worldToString(),b="";return _.forEach(this.membranes,function(a){b+=a.toString()}),"("+this.id+")["+a.slice(1,a.length-1)+b+"]"},h.prototype.worldToString=function(){return e.setToString(this.world)},e.Membrane=h,c["default"]=h}),define("MJS/mjs",["exports"],function(a){"use strict";var b={};b.log=function(a){console&&console.log(a),"undefined"!=typeof $&&$(".log").prepend(a+"<br>")},b.setToString=function(a){var b=["["];return _.forEach(a,function(a,c){_.times(a,function(){b.push(c)})}),b.push("]"),b.join(" ")},b.selectRandomIn=function(a){return a[Math.floor(Math.random()*a.length)]},b.cloneObjectArray=function(a){return _.map(a,function(a){return a.clone})},a["default"]=b}),define("MJS/rule",["MJS/mjs","exports"],function(a,b){"use strict";var c=a["default"],d=function(a){if(_.assign(this,{type:d.Type.EVOLVE,reactants:{},products:{},charge:null,label:null},a),"undefined"==typeof this.type)throw"Unsupported Rule Type("+this.type+")"};d.prototype.clone=function(){return new d({type:this.type,reactants:_.cloneDeep(this.reactants),products:_.cloneDeep(this.products),charge:this.charge,label:this.label})},d.prototype.numberApplications=function(a,b){var d,e=0,f=_.cloneDeep(a);do d=this.applyRule(f,c.cloneObjectArray(b)),d&&(e+=1);while(d);return e},d.prototype.applyRule=function(a,b,e){var f=this,g=!0,h={};return _.isArray(b)&&(e=b,b=null),_.forEach(f.reactants,function(b,c){return"undefined"==typeof a[c]||a[c]<b?(g=!1,!1):void 0}),this.type!==d.Type.SEND_IN||e&&0!==e.length||(g=!1),g&&(_.forEach(f.reactants,function(c,d){a[d]-=c,b&&(b[d]-=c)}),b&&c.log("apply rule: "+this.toString()),_.forEach(f.products,function(a,g){var i=b;f.type===d.Type.SEND_OUT||f.type===d.Type.DISSOLVE?i=h:f.type===d.Type.SEND_IN&&(i=c.selectRandomIn(e).world),i&&"undefined"==typeof i[g]&&(i[g]=0),i&&(i[g]+=a)})),_.keys(h).length?h:g},d.prototype.toString=function(){return"Rule("+this.type+") react"+c.setToString(this.reactants)+" prod"+c.setToString(this.products)},d.Type={EVOLVE:"evolve",SEND_OUT:"sendOut",DISSOLVE:"dissolve",SEND_IN:"sendIn"},c.Rule=d,b["default"]=d});
//# sourceMappingURL=membrane.min.js.map