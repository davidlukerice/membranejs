/* membranejs 0.0.1 2014-11-30 */

define("MJS/mSystem",["MJS/mjs","exports"],function(a,b){"use strict";var c=a["default"],d=function(a){_.assign(this,{membrane:null,world:{}},a)};d.prototype.simulate=function(a){var b=!0;a=a||100,c.log("simulating");for(var d=0;a>d&&b;++d){if(c.log("- step: "+(d+1)),c.log("system world before: "+this.toString()),b=this.membrane.step(this.world),b.dissolved)throw"Error: Outermost membrane dissolved";c.log("system world after: "+this.toString())}c.log("finished")},d.prototype.toString=function(){return this.worldToString()+" "+this.membrane.toString()},d.prototype.worldToString=function(){return c.setToString(this.world)},c.MSystem=d,b["default"]=d}),define("MJS/membrane",["MJS/mjs","MJS/rule","exports"],function(a,b,c){"use strict";function d(a){for(var b,c,d=a.length;d;b=Math.floor(Math.random()*d),c=a[--d],a[d]=a[b],a[b]=c);return a}var e=a["default"],f=b["default"],g=0,h=function(a){_.assign(this,{rules:[],world:{},membranes:[],label:null,charge:null},a),this.id=++g};h.prototype.step=function(a){for(var b=this,c=!1,g=!1,h=0;h<this.membranes.length;++h){var i=this.membranes[h],j=i.step(b.world);j.dissolved&&(e.log("dissolving "+i.id),this.membranes.splice(h--,1)),j&&(c=!0)}var k=[];_.forEach(this.rules,function(a){_.times(a.numberApplications(b.world),function(){k.push(a)})}),e.log("membrane before: "+this.toString()),d(k);var l=_.cloneDeep(this.world);return _.forEach(k,function(d){var e=d.applyRule(l,b.world);return _.isObject(e)&&_.forEach(e,function(b,c){"undefined"==typeof a[c]&&(a[c]=0),a[c]+=b}),e&&(c=!0,d.type===f.Type.DISSOLVE)?(g=!0,!1):void 0}),e.log("membrane after: "+this.toString()),g?{dissolved:!0}:c},h.prototype.toString=function(){var a=this.worldToString(),b="";return _.forEach(this.membranes,function(a){b+=a.toString()}),"("+this.id+")["+a.slice(1,a.length-1)+b+"]"},h.prototype.worldToString=function(){return e.setToString(this.world)},e.Membrane=h,c["default"]=h}),define("MJS/mjs",["exports"],function(a){"use strict";var b={};b.log=function(a){console&&console.log(a),"undefined"!=typeof $&&$(".log").prepend(a+"<br>")},b.setToString=function(a){var b=["["];return _.forEach(a,function(a,c){_.times(a,function(){b.push(c)})}),b.push("]"),b.join(" ")},a["default"]=b}),define("MJS/rule",["MJS/mjs","exports"],function(a,b){"use strict";var c=a["default"],d=function(a){_.assign(this,{type:d.Type.EVOLVE,reactants:{},products:{},charge:null,label:null},a)};d.prototype.numberApplications=function(a){var b,c=0,d=_.cloneDeep(a);do b=this.applyRule(d),b&&(c+=1);while(b);return c},d.prototype.applyRule=function(a,b){var e=this,f=!0,g={};return _.forEach(e.reactants,function(b,c){return"undefined"==typeof a[c]||a[c]<b?(f=!1,!1):void 0}),f&&(_.forEach(e.reactants,function(c,d){a[d]-=c,b&&(b[d]-=c)}),b&&c.log("apply rule: "+this.toString()),_.forEach(e.products,function(a,c){var f=b;(e.type===d.Type.SEND_OUT||e.type===d.Type.DISSOLVE)&&(f=g),f&&"undefined"==typeof f[c]&&(f[c]=0),f&&(f[c]+=a)})),_.keys(g).length?g:f},d.prototype.toString=function(){return"Rule("+this.type+") react"+c.setToString(this.reactants)+" prod"+c.setToString(this.products)},d.Type={EVOLVE:"evolve",SEND_OUT:"sendOut",DISSOLVE:"dissolve"},c.Rule=d,b["default"]=d});
//# sourceMappingURL=membrane.min.js.map